version: '3.4'

networks:
  main-net:

services:

  loss-prevention:
    image: rsp/loss-prevention-service:dev
    networks:
      - main-net
    extra_hosts:
      - "edgex-core-data:172.17.0.1"
      - "edgex-support-logging:172.17.0.1"
      - "edgex-core-consul:172.17.0.1"
      - "edgex-core-command:172.17.0.1"
    logging:
      options:
        max-size: "100m"
        max-file: "5"
    restart: always
    security_opt:
      - apparmor=unconfined
    environment:
      serviceName: "Loss Prevention Example App"
      DISPLAY: unix:0
      loggingLevel: "debug"
      videoUrlBase: "http://localhost:9091/material-dashboard/view.html?v="
      liveView: "true"
      showVideoDebugStats: "true"
      videoCaptureFOURCC: "MJPG"
      recordingDuration: 15
      videoResolutionWidth: 1280
      videoResolutionHeight: 720
      videoOutputFps: 25
      videoOutputCodec: "avc1"
      videoOutputExtension: ".mp4"

#      ipCameraStreamUrl: ""
      usbCameraDeviceIndex: 0

      epcFilter: "*"
#      epcFilter: "3035*72[CB][0-6EF]"
      skuFilter: "*"

    volumes:
      - ./recordings:/recordings
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /var/run/dbus:/var/run/dbus
    devices:
      - /dev/video0:/dev/video0

  nginx:
    image: nginx:latest
    networks:
      - main-net
    logging:
      options:
        max-size: "100m"
        max-file: "5"
    restart: always
    ports:
      - "9091:80"
    volumes:
      - ./video-server/www:/usr/share/nginx/html
      - ./recordings:/usr/share/nginx/html/recordings
